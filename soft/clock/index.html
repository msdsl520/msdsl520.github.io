<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轻时钟</title>
    <script src="https://cdn.tailwindcss.com"></script>
<meta name="description" content="一个轻量化的简单网页时钟">
<meta name="keywords" content="轻时钟,msdsl时钟,网页时钟">
      <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.544.0/dist/umd/lucide.min.js"></script>
    <style>
        body {
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        .time-display {
            font-variant-numeric: tabular-nums;
        }
        .world-time-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .world-time-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .lap-item {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .tab-btn {
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .tab-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">

        <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg rounded-t-2xl z-50">
            <div class="flex justify-around p-2">
                <button class="tab-btn active flex flex-col items-center p-3 rounded-lg transition-all duration-300" data-tab="pomodoro">
                    <span class="text-sm">番茄钟</span>
                </button>
                <button class="tab-btn flex flex-col items-center p-3 rounded-lg transition-all duration-300" data-tab="world-time">
                    <span class="text-sm">世界时间</span>
                </button>
                <button class="tab-btn flex flex-col items-center p-3 rounded-lg transition-all duration-300" data-tab="stopwatch">
                    <span class="text-sm">秒表</span>
                </button>
                <button class="tab-btn flex flex-col items-center p-3 rounded-lg transition-all duration-300" data-tab="timer">
                    <span class="text-sm">计时器</span>
                </button>
            </div>
        </nav>


        <div class="hidden lg:flex justify-center mb-8 bg-white rounded-xl shadow-lg p-2">
            <button class="tab-btn active px-6 py-3 rounded-lg mr-2 transition-all duration-300" data-tab="pomodoro">
                <span>番茄钟</span>
            </button>
            <button class="tab-btn px-6 py-3 rounded-lg mr-2 transition-all duration-300" data-tab="world-time">
                <span>世界时间</span>
            </button>
            <button class="tab-btn px-6 py-3 rounded-lg mr-2 transition-all duration-300" data-tab="stopwatch">
                <span>秒表</span>
            </button>
            <button class="tab-btn px-6 py-3 rounded-lg transition-all duration-300" data-tab="timer">
                <span>计时器</span>
            </button>
        </div>




        <div id="pomodoro" class="tab-content active pt-4 lg:pt-0">
            <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                <div class="mb-8 flex justify-center">
                    <div class="relative">
                        <svg class="progress-ring w-64 h-64" viewBox="0 0 120 120">
                            <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="52" cx="60" cy="60"></circle>
                            <circle id="pomodoro-progress" class="progress-ring-circle text-blue-500" stroke-width="8" stroke="currentColor" fill="transparent" r="52" cx="60" cy="60" stroke-dasharray="326.7256359733385" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <h2 id="pomodoro-mode" class="text-xl font-semibold mb-2">专注时间</h2>
                            <div class="time-display text-5xl font-bold" id="pomodoro-timer">25:00</div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-center space-x-4" id="pomodoro-controls">
                    <button id="pomodoro-start" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-medium transition-colors flex items-center">
                        <i data-lucide="play" class="w-5 h-5 mr-2"></i>开始
                    </button>
                    <button id="pomodoro-reset" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-8 py-3 rounded-lg font-medium transition-colors flex items-center">
                        <i data-lucide="rotate-ccw" class="w-5 h-5 mr-2"></i>重置
                    </button>
                    <button id="skip-break" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-lg font-medium transition-colors flex items-center" style="display: none;">
                        <i data-lucide="skip-forward" class="w-5 h-5 mr-2"></i>跳过休息
                    </button>
                </div>
                <div class="mt-4">
                    <div class="text-sm text-gray-600">已完成工作周期: <span id="completed-cycles" class="font-semibold">0</span></div>
                </div>
                <div class="mt-8" id="pomodoro-settings">
                    <div class="flex justify-center space-x-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">工作时长</label>
                            <input type="number" id="work-duration" value="25" min="1" max="60" class="w-20 px-3 py-2 border border-gray-300 rounded-lg bg-white text-center">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">休息时长</label>
                            <input type="number" id="break-duration" value="5" min="1" max="30" class="w-20 px-3 py-2 border border-gray-300 rounded-lg bg-white text-center">
                        </div>
                    </div>
                    <div id="pomodoro-error" class="hidden mt-4 text-red-500 text-sm"></div>
                </div>
            </div>
        </div>


        <div id="world-time" class="tab-content pt-4 lg:pt-0">
            <div class="bg-white rounded-2xl shadow-lg p-6">

                <div class="mb-6 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-4 text-white relative overflow-hidden">
                    <div class="flex justify-between items-center relative z-10">
                        <div>
                            <h2 class="text-lg font-semibold mb-1">北京时间</h2>
                            <div class="flex items-baseline">
                                <div class="text-4xl font-bold" id="beijing-time">00:00</div>
                                <div class="text-xl ml-2" id="beijing-date">2025年12月26日</div>
                            </div>
                        </div>
                        <button onclick="window.location.href='fullscreen.html'" class="text-white hover:text-gray-200 transition-colors p-3 rounded-full hover:bg-white/10" title="全屏显示时钟" style="cursor: pointer; display: inline-flex; align-items: center; justify-content: center; min-width: 44px; min-height: 44px; border: none; background: none;">
                            <i data-lucide="maximize" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="absolute bottom-0 right-0 opacity-10">
                        <i data-lucide="clock" class="w-24 h-24"></i>
                    </div>
                </div>
                

                <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <input type="text" id="search-city" placeholder="搜索城市..." class="flex-grow px-4 py-3 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="show-seconds-toggle" class="sr-only peer">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        <span class="ml-3 text-sm font-medium text-gray-700">显示秒</span>
                    </label>
                </div>
                
                <div id="world-time-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[500px] overflow-y-auto no-scrollbar">

                </div>
            </div>
        </div>


        <div id="stopwatch" class="tab-content pt-4 lg:pt-0">
            <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                <div class="time-display text-6xl font-bold mb-8" id="stopwatch-timer">00:00.00</div>
                <div class="flex justify-center space-x-4 mb-8">
                    <button id="stopwatch-start" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-medium transition-colors flex items-center">
                        <i data-lucide="play" class="w-5 h-5 mr-2"></i>开始
                    </button>
                    <button id="stopwatch-lap" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-8 py-3 rounded-lg font-medium transition-colors flex items-center opacity-50 cursor-not-allowed" disabled="">
                        <i data-lucide="flag" class="w-5 h-5 mr-2"></i>计次
                    </button>
                    <button id="stopwatch-reset" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-8 py-3 rounded-lg font-medium transition-colors flex items-center">
                        <i data-lucide="rotate-ccw" class="w-5 h-5 mr-2"></i>重置
                    </button>
                </div>
                <div id="lap-list" class="max-h-64 overflow-y-auto no-scrollbar">

                </div>
            </div>
        </div>


        <div id="timer" class="tab-content pt-4 lg:pt-0">
            <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                <div class="mb-8 flex justify-center">
                    <div class="relative">
                        <svg class="progress-ring w-64 h-64" viewBox="0 0 120 120">
                            <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="52" cx="60" cy="60"></circle>
                            <circle id="timer-progress" class="progress-ring-circle text-blue-500" stroke-width="8" stroke="currentColor" fill="transparent" r="52" cx="60" cy="60" stroke-dasharray="326.7256359733385" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <div class="time-display text-5xl font-bold cursor-pointer" id="timer-display" onclick="editTimerTime()">05:00</div>
                            <input type="number" id="timer-edit-input" placeholder="输入分钟" min="1" max="1440" class="hidden absolute text-5xl font-bold w-24 text-center bg-transparent border-2 border-blue-500 rounded-lg">
                            <div id="timer-hint" class="text-sm text-gray-500 mt-2">点击编辑时间</div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-center space-x-4 mb-8">
                    <button id="timer-start" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-medium transition-colors flex items-center">
                        <i data-lucide="play" class="w-5 h-5 mr-2"></i>开始
                    </button>
                    <button id="timer-pause" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-8 py-3 rounded-lg font-medium transition-colors flex items-center" style="display: none;">
                        <i data-lucide="pause" class="w-5 h-5 mr-2"></i>暂停
                    </button>
                    <button id="timer-reset" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-8 py-3 rounded-lg font-medium transition-colors flex items-center">
                        <i data-lucide="rotate-ccw" class="w-5 h-5 mr-2"></i>重置
                    </button>
                </div>
                <div class="flex justify-center space-x-4" id="timer-settings">
                    <button class="time-preset bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg" data-minutes="1">1分钟</button>
                    <button class="time-preset bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg" data-minutes="5">5分钟</button>
                    <button class="time-preset bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg" data-minutes="10">10分钟</button>
                    <button class="time-preset bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg" data-minutes="15">15分钟</button>
                    <button class="time-preset bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg" data-minutes="30">30分钟</button>
                </div>
            </div>
        </div>
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function() {
            
            lucide.createIcons();

            const html = document.documentElement;

        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');



        function switchTab(tabId) {
            if (!tabId) {
                console.error('选项卡ID不能为空');
                return;
            }
            
            localStorage.setItem('lastActiveTab', tabId);
            
            tabBtns.forEach(b => {
                b.classList.remove('active', 'text-blue-500');
                b.style.backgroundColor = '';
                b.style.color = '';
            });
            
            const activeBtn = document.querySelector(`[data-tab="${tabId}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'text-blue-500');
                activeBtn.style.backgroundColor = html.classList.contains('dark') ? '#3b82f620' : '#3b82f610';
                activeBtn.style.color = '#3b82f6';
            }
            
            tabContents.forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            const targetContent = document.getElementById(tabId);
            if (targetContent) {
                setTimeout(() => {
                    targetContent.classList.add('active');
                    targetContent.style.display = 'block';

                }, 10);
            } else {
                console.error('找不到选项卡内容元素:', tabId);
            }
        }
        
        tabBtns.forEach(btn => {
            const tabId = btn.dataset.tab;

            
            if (!tabId) {
                console.error('选项卡缺少data-tab属性:', btn);
                return;
            }
            
            btn.onclick = function(e) {
                e = e || window.event;
                if (e.preventDefault) e.preventDefault();
                if (e.stopPropagation) e.stopPropagation();
                e.cancelBubble = true;
                

                switchTab(tabId);
            };
            
            btn.ontouchstart = function(e) {
                e = e || window.event;
                if (e.preventDefault) e.preventDefault();
                e.cancelBubble = true;
                

                switchTab(tabId);
            };
        });
        
        const firstTabId = tabBtns[0]?.dataset.tab;
        const savedTab = localStorage.getItem('lastActiveTab');
        
        if (savedTab && document.getElementById(savedTab)) {
            switchTab(savedTab);
        } else if (firstTabId) {
            switchTab(firstTabId);
        }

        const pomodoroTimer = document.getElementById('pomodoro-timer');
        const pomodoroProgress = document.getElementById('pomodoro-progress');
        const pomodoroStart = document.getElementById('pomodoro-start');
        const pomodoroReset = document.getElementById('pomodoro-reset');
        const pomodoroMode = document.getElementById('pomodoro-mode');
        const workDurationInput = document.getElementById('work-duration');
        const breakDurationInput = document.getElementById('break-duration');

        let pomodoroInterval;
        let pomodoroTimeLeft = 25 * 60;
        let isWorkMode = true;
        let isPomodoroRunning = false;
        let completedCycles = 0;
        let autoStartNext = true;
        const pomodoroCircumference = 2 * Math.PI * 52;
        pomodoroProgress.style.strokeDasharray = pomodoroCircumference;

        function updatePomodoroDisplay() {
            const minutes = Math.floor(pomodoroTimeLeft / 60);
            const seconds = pomodoroTimeLeft % 60;
            
            if (pomodoroTimeLeft <= 0) {
                pomodoroTimer.textContent = '时间到！';
                pomodoroTimer.classList.add('text-red-500');
            } else {
                pomodoroTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                pomodoroTimer.classList.remove('text-red-500');
            }
            
            const totalTime = isWorkMode ? workDurationInput.value * 60 : breakDurationInput.value * 60;
            const progress = pomodoroTimeLeft / totalTime;
            const offset = pomodoroCircumference - (progress * pomodoroCircumference);
            pomodoroProgress.style.strokeDashoffset = offset;
            
            if (isWorkMode) {
                pomodoroProgress.classList.remove('text-green-500');
                pomodoroProgress.classList.add('text-blue-500');
            } else {
                pomodoroProgress.classList.remove('text-blue-500');
                pomodoroProgress.classList.add('text-green-500');
            }
        }

        function startPomodoro() {
            if (isPomodoroRunning) return;
            
            const workDuration = parseInt(workDurationInput.value);
            const breakDuration = parseInt(breakDurationInput.value);
            
            if (workDuration <= 0 || breakDuration <= 0) {
                const errorElement = document.getElementById('pomodoro-error');
                errorElement.textContent = '工作时长和休息时长必须大于0！';
                errorElement.classList.remove('hidden');
                return;
            }
            
            isPomodoroRunning = true;
            pomodoroStart.innerHTML = '<i data-lucide="pause" class="w-5 h-5 mr-2"></i>暂停';
            lucide.createIcons();
            
            document.getElementById('pomodoro-settings').style.display = 'none';
            
            pomodoroInterval = setInterval(() => {
                pomodoroTimeLeft--;
                updatePomodoroDisplay();
                
                if (pomodoroTimeLeft <= 0) {
                    clearInterval(pomodoroInterval);
                    playNotificationSound();
                    
                    if (isWorkMode) {
                        completedCycles++;
                        document.getElementById('completed-cycles').textContent = completedCycles;
                    }
                    
                    isWorkMode = !isWorkMode;
                    pomodoroMode.textContent = isWorkMode ? '专注时间' : '休息时间';
                    pomodoroTimeLeft = isWorkMode ? workDurationInput.value * 60 : breakDurationInput.value * 60;
                    updatePomodoroDisplay();
                    
                    const skipBreakBtn = document.getElementById('skip-break');
                    if (!isWorkMode) {
                        skipBreakBtn.style.display = 'flex';
                    } else {
                        skipBreakBtn.style.display = 'none';
                    }
                    
                    isPomodoroRunning = false;
                    pomodoroStart.innerHTML = '<i data-lucide="play" class="w-5 h-5 mr-2"></i>开始';
                    lucide.createIcons();
                    
                    if (autoStartNext) {
                        setTimeout(() => {
                            startPomodoro();
                        }, 1000);
                    }
                }
            }, 1000);
        }

        function pausePomodoro() {
            clearInterval(pomodoroInterval);
            isPomodoroRunning = false;
            pomodoroStart.innerHTML = '<i data-lucide="play" class="w-5 h-5 mr-2"></i>开始';
            lucide.createIcons();
        }

        function resetPomodoro() {
            clearInterval(pomodoroInterval);
            isPomodoroRunning = false;
            isWorkMode = true;
            pomodoroMode.textContent = '专注时间';
            pomodoroTimeLeft = workDurationInput.value * 60;
            updatePomodoroDisplay();
            pomodoroStart.innerHTML = '<i data-lucide="play" class="w-5 h-5 mr-2"></i>开始';
            lucide.createIcons();
            
            document.getElementById('pomodoro-settings').style.display = 'block';
            document.getElementById('pomodoro-error').classList.add('hidden');
            document.getElementById('skip-break').style.display = 'none';
        }

        pomodoroStart.addEventListener('click', () => {
            if (isPomodoroRunning) {
                pausePomodoro();
            } else {
                requestNotificationPermission();
                startPomodoro();
            }
        });

        pomodoroReset.addEventListener('click', resetPomodoro);

        const skipBreakBtn = document.getElementById('skip-break');
        skipBreakBtn.addEventListener('click', () => {
            clearInterval(pomodoroInterval);
            isWorkMode = true;
            pomodoroMode.textContent = '专注时间';
            pomodoroTimeLeft = workDurationInput.value * 60;
            updatePomodoroDisplay();
            isPomodoroRunning = false;
            pomodoroStart.innerHTML = '<i data-lucide="play" class="w-5 h-5 mr-2"></i>开始';
            skipBreakBtn.style.display = 'none';
            lucide.createIcons();
            
            if (autoStartNext) {
                setTimeout(() => {
                    startPomodoro();
                }, 1000);
            }
        });

        workDurationInput.addEventListener('change', () => {
            if (isWorkMode && !isPomodoroRunning) {
                pomodoroTimeLeft = workDurationInput.value * 60;
                updatePomodoroDisplay();
            }
        });

        breakDurationInput.addEventListener('change', () => {
            if (!isWorkMode && !isPomodoroRunning) {
                pomodoroTimeLeft = breakDurationInput.value * 60;
                updatePomodoroDisplay();
            }
        });


        const worldTimeList = document.getElementById('world-time-list');
        const searchCityInput = document.getElementById('search-city');
        const showSecondsToggle = document.getElementById('show-seconds-toggle');
        const beijingTimeElement = document.getElementById('beijing-time');
        const beijingDateElement = document.getElementById('beijing-date');
        let showSeconds = false;
        
        const cities = [
            { name: '纽约', timezone: 'America/New_York' },
            { name: '伦敦', timezone: 'Europe/London' },
            { name: '东京', timezone: 'Asia/Tokyo' },
            { name: '悉尼', timezone: 'Australia/Sydney' },
            { name: '巴黎', timezone: 'Europe/Paris' },
            { name: '迪拜', timezone: 'Asia/Dubai' },
            { name: '洛杉矶', timezone: 'America/Los_Angeles' },
            { name: '莫斯科', timezone: 'Europe/Moscow' }
        ];

        function updateWorldTimes() {
            worldTimeList.innerHTML = '';
            
            cities.forEach(city => {
                const now = new Date();
                const cityTime = new Date(now.toLocaleString('en-US', { timeZone: city.timezone }));
                
                const hours = cityTime.getHours().toString().padStart(2, '0');
                const minutes = cityTime.getMinutes().toString().padStart(2, '0');
                const seconds = cityTime.getSeconds().toString().padStart(2, '0');
                const date = cityTime.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                
                const timeCard = document.createElement('div');
                timeCard.className = 'world-time-card bg-gray-50 rounded-xl p-4 flex justify-between items-center';
                timeCard.innerHTML = `
                    <div class="flex-grow">
                        <h3 class="text-lg font-semibold">${city.name}</h3>
                        <p class="text-sm text-gray-500">${date}</p>
                    </div>
                    <div class="text-2xl font-bold">${hours}:${minutes}${showSeconds ? `:${seconds}` : ''}</div>
                `;
                
                worldTimeList.appendChild(timeCard);
            });
        }

        searchCityInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredCities = cities.filter(city => city.name.toLowerCase().includes(searchTerm));
            
            worldTimeList.innerHTML = '';
            filteredCities.forEach(city => {
                const now = new Date();
                const cityTime = new Date(now.toLocaleString('en-US', { timeZone: city.timezone }));
                
                const hours = cityTime.getHours().toString().padStart(2, '0');
                const minutes = cityTime.getMinutes().toString().padStart(2, '0');
                const seconds = cityTime.getSeconds().toString().padStart(2, '0');
                const date = cityTime.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                
                const timeCard = document.createElement('div');
                timeCard.className = 'world-time-card bg-gray-50 rounded-xl p-4 flex justify-between items-center';
                timeCard.innerHTML = `
                    <div class="flex-grow">
                        <h3 class="text-lg font-semibold">${city.name}</h3>
                        <p class="text-sm text-gray-500">${date}</p>
                    </div>
                    <div class="text-2xl font-bold">${hours}:${minutes}${showSeconds ? `:${seconds}` : ''}</div>
                `;
                
                worldTimeList.appendChild(timeCard);
            });
        });

        // 更新北京时间显示
        function updateBeijingTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const date = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            
            beijingTimeElement.textContent = showSeconds ? `${hours}:${minutes}:${seconds}` : `${hours}:${minutes}`;
            beijingDateElement.textContent = date;
        }

        // 显示秒开关事件监听
        showSecondsToggle.addEventListener('change', (e) => {
            showSeconds = e.target.checked;
            updateBeijingTime(); // 更新北京时间显示
            updateWorldTimes(); // 立即更新显示
            // 重新设置更新间隔
            clearInterval(worldTimeInterval);
            worldTimeInterval = setInterval(() => {
                updateBeijingTime();
                updateWorldTimes();
            }, showSeconds ? 1000 : 60000);
        });

        const stopwatchTimer = document.getElementById('stopwatch-timer');
        const stopwatchStart = document.getElementById('stopwatch-start');
        const stopwatchLap = document.getElementById('stopwatch-lap');
        const stopwatchReset = document.getElementById('stopwatch-reset');
        const lapList = document.getElementById('lap-list');

        let stopwatchInterval;
        let stopwatchTime = 0;
        let isStopwatchRunning = false;
        let lapCount = 0;

        function updateStopwatchDisplay() {
            const minutes = Math.floor(stopwatchTime / 6000);
            const seconds = Math.floor((stopwatchTime % 6000) / 100);
            const centiseconds = stopwatchTime % 100;
            stopwatchTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${centiseconds.toString().padStart(2, '0')}`;
        }

        function startStopwatch() {
            if (isStopwatchRunning) return;
            
            isStopwatchRunning = true;
            stopwatchStart.innerHTML = '<i data-lucide="pause" class="w-5 h-5 mr-2"></i>暂停';
            stopwatchLap.disabled = false;
            stopwatchLap.classList.remove('opacity-50', 'cursor-not-allowed');
            lucide.createIcons();
            
            const startTime = Date.now() - stopwatchTime * 10;
            stopwatchInterval = setInterval(() => {
                stopwatchTime = Math.floor((Date.now() - startTime) / 10);
                updateStopwatchDisplay();
            }, 10);
        }

        function pauseStopwatch() {
            clearInterval(stopwatchInterval);
            isStopwatchRunning = false;
            stopwatchStart.innerHTML = '<i data-lucide="play" class="w-5 h-5 mr-2"></i>继续';
            lucide.createIcons();
        }

        function resetStopwatch() {
            clearInterval(stopwatchInterval);
            isStopwatchRunning = false;
            stopwatchTime = 0;
            lapCount = 0;
            updateStopwatchDisplay();
            stopwatchStart.innerHTML = '<i data-lucide="play" class="w-5 h-5 mr-2"></i>开始';
            stopwatchLap.disabled = true;
            stopwatchLap.classList.add('opacity-50', 'cursor-not-allowed');
            lapList.innerHTML = '';
            lucide.createIcons();
        }

        function recordLap() {
            lapCount++;
            const minutes = Math.floor(stopwatchTime / 6000);
            const seconds = Math.floor((stopwatchTime % 6000) / 100);
            const centiseconds = stopwatchTime % 100;
            
            const lapTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${centiseconds.toString().padStart(2, '0')}`;
            
            const lapItem = document.createElement('div');
            lapItem.className = 'lap-item flex justify-between items-center p-3 border-b border-gray-200';
            lapItem.innerHTML = `
                <span class="font-medium">第 ${lapCount} 圈</span>
                <span class="font-mono font-bold">${lapTime}</span>
            `;
            
            lapList.insertBefore(lapItem, lapList.firstChild);
        }

        stopwatchStart.addEventListener('click', () => {
            if (isStopwatchRunning) {
                pauseStopwatch();
            } else {
                startStopwatch();
            }
        });

        stopwatchLap.addEventListener('click', recordLap);
        stopwatchReset.addEventListener('click', resetStopwatch);

        // 计时器功能
        const timerDisplay = document.getElementById('timer-display');
        const timerEditInput = document.getElementById('timer-edit-input');
        const timerProgress = document.getElementById('timer-progress');
        const timerStart = document.getElementById('timer-start');
        const timerPause = document.getElementById('timer-pause');
        const timerReset = document.getElementById('timer-reset');
        const customTimeInput = document.getElementById('custom-time');
        const setCustomTimeBtn = document.getElementById('set-custom-time');
        const timePresets = document.querySelectorAll('.time-preset');

        let timerInterval;
        let timerTimeLeft = 5 * 60; // 5分钟
        let timerDuration = timerTimeLeft;
        let isTimerRunning = false;
        const timerCircumference = 2 * Math.PI * 52;
        timerProgress.style.strokeDasharray = timerCircumference;

        // 编辑计时器时间的函数
        window.editTimerTime = function() {
            if (isTimerRunning) return; // 只在暂停时可编辑
            
            // 立即隐藏提示文字
            document.getElementById('timer-hint').style.display = 'none';
            
            const currentMinutes = Math.floor(timerTimeLeft / 60);
            timerDisplay.style.display = 'none';
            timerEditInput.value = currentMinutes;
            timerEditInput.style.display = 'block';
            timerEditInput.focus();
            timerEditInput.select();
        };

        // 处理编辑输入
        timerEditInput.addEventListener('blur', () => {
            saveTimerEdit();
        });

        timerEditInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveTimerEdit();
            } else if (e.key === 'Escape') {
                cancelTimerEdit();
            }
        });

        // 提示文字显示逻辑
        function showHint() {
            if (!isTimerRunning) {
                document.getElementById('timer-hint').style.display = 'block';
            }
        }
        
        function hideHint() {
            document.getElementById('timer-hint').style.display = 'none';
        }
        
        // 初始化时显示提示
        showHint();

        function saveTimerEdit() {
            let minutes = parseInt(timerEditInput.value);
            if (isNaN(minutes) || minutes < 1) {
                minutes = 1;
            } else if (minutes > 1440) {
                minutes = 1440;
            }
            
            timerDuration = minutes * 60;
            timerTimeLeft = timerDuration;
            updateTimerDisplay();
            
            timerEditInput.style.display = 'none';
            timerDisplay.style.display = 'block';
            showHint();
        }

        function cancelTimerEdit() {
            timerEditInput.style.display = 'none';
            timerDisplay.style.display = 'block';
            showHint();
            showHint();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerTimeLeft / 60);
            const seconds = timerTimeLeft % 60;
            
            if (timerTimeLeft <= 0) {
                timerDisplay.textContent = '时间到！';
                timerDisplay.classList.add('text-red-500');
            } else {
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timerDisplay.classList.remove('text-red-500');
            }
            
            const progress = timerTimeLeft / timerDuration;
            const offset = timerCircumference - (progress * timerCircumference);
            timerProgress.style.strokeDashoffset = offset;
        }

        function startTimer() {
            if (isTimerRunning) return;
            
            if (timerTimeLeft <= 0) {
                // 重置为默认时间5分钟
                timerTimeLeft = 5 * 60;
                timerDuration = timerTimeLeft;
                updateTimerDisplay();
            }
            
            isTimerRunning = true;
            timerStart.style.display = 'none';
            timerPause.style.display = 'flex';
            
            document.getElementById('timer-settings').style.display = 'none';
            hideHint();
            
            timerInterval = setInterval(() => {
                timerTimeLeft--;
                updateTimerDisplay();
                
                if (timerTimeLeft <= 0) {
                    clearInterval(timerInterval);
                    isTimerRunning = false;
                    timerStart.style.display = 'flex';
                    timerPause.style.display = 'none';
                    playNotificationSound();
                    showNotification('计时器已完成！');
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            timerStart.style.display = 'flex';
            timerPause.style.display = 'none';
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            timerTimeLeft = timerDuration;
            updateTimerDisplay();
            timerStart.style.display = 'flex';
            timerPause.style.display = 'none';
            
            document.getElementById('timer-settings').style.display = 'flex';
            document.getElementById('timer-error').classList.add('hidden');
            
            // 显示提示文字
            showHint();
        }

        function setTimerDuration(minutes) {
            timerDuration = minutes * 60;
            timerTimeLeft = timerDuration;
            updateTimerDisplay();
        }

        timerStart.addEventListener('click', () => {
            // 请求通知权限
            requestNotificationPermission();
            startTimer();
        });
        timerPause.addEventListener('click', pauseTimer);
        timerReset.addEventListener('click', resetTimer);

        timePresets.forEach(preset => {
            preset.addEventListener('click', () => {
                const minutes = parseInt(preset.dataset.minutes);
                setTimerDuration(minutes);
                
                // 立即开始计时
                if (!isTimerRunning) {
                    startTimer();
                }
            });
        });



        // 通知和声音
        function playNotificationSound() {
            // 创建音频上下文
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function showNotification(message) {
            // 播放提示音（无论通知权限如何都播放）
            playNotificationSound();
            
            // 显示桌面通知（如果权限允许）
            if ('Notification' in window && notificationPermission === 'granted') {
                new Notification('时钟提醒', {
                    body: message,
                    icon: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/b77877d4074e48919cec8353db8839bb~tplv-a9rns2rl98-image.image?rcl=20251220003317E0C7D1EA0D54D69D1B6B&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1768754013&x-signature=SCR%2FptCykgwjPy5xGVRalRmrvEA%3D'
                });
            } else {
                // 如果通知权限被拒绝，显示页面内提示
                showInPageNotification(message);
            }
        }

        // 播放通知提示音
        function playNotificationSound() {
            try {
                // 使用Web Audio API创建简单的提示音
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {

            }
        }

        // 显示页面内通知
        function showInPageNotification(message) {
            const notificationElement = document.getElementById('in-page-notification');
            if (notificationElement) {
                notificationElement.remove();
            }
            
            const notification = document.createElement('div');
            notification.id = 'in-page-notification';
            notification.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white border-2 border-blue-500 p-6 rounded-lg shadow-xl z-50 text-center max-w-xs';
            notification.innerHTML = `
                <div class="mb-4">
                    <i data-lucide="bell" class="w-12 h-12 text-blue-500 mx-auto"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">时间到</h3>
                <p class="text-gray-600 mb-4">${message}</p>
                <button onclick="this.parentElement.remove()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    关闭
                </button>
            `;
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            // 10秒后自动关闭
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 10000);
        }

        // 通知权限状态
        let notificationPermission = 'default';

        // 请求通知权限的函数
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                // 先检查当前权限状态
                if (Notification.permission === 'default') {
                    notificationPermission = await Notification.requestPermission();
                    
                    // 如果用户拒绝了权限，显示提示
                    if (notificationPermission === 'denied') {
                        showNotificationPermissionGuide();
                    }
                } else {
                    // 更新本地权限状态
                    notificationPermission = Notification.permission;
                    
                    // 如果权限被拒绝，显示提示
                    if (notificationPermission === 'denied') {
                        showNotificationPermissionGuide();
                    }
                }
            }
            return notificationPermission;
        }

        // 显示通知权限指引
        function showNotificationPermissionGuide() {
            const guideElement = document.getElementById('notification-guide');
            if (guideElement) {
                guideElement.style.display = 'block';
            } else {
                const guide = document.createElement('div');
                guide.id = 'notification-guide';
                guide.className = 'fixed top-4 right-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded shadow-lg z-50 max-w-sm';
                guide.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i data-lucide="bell-off" class="w-5 h-5 text-yellow-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700 font-medium">通知权限已被阻止</p>
                            <p class="text-xs text-yellow-600 mt-1">请在浏览器设置中允许通知权限，以便在计时结束时收到提醒。</p>
                            <button onclick="this.parentElement.parentElement.parentElement.style.display='none'" 
                                    class="mt-2 text-xs text-blue-600 hover:text-blue-800 font-medium">
                                知道了
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(guide);
                lucide.createIcons();
            }
        }

        updatePomodoroDisplay();
        updateBeijingTime(); 
        updateWorldTimes();
        updateTimerDisplay();
        

        
        let worldTimeInterval = setInterval(() => {
            updateBeijingTime();
            updateWorldTimes();
        }, showSeconds ? 1000 : 60000);
        

        

    });
    </script>

</body></html>